<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Readers · BGZFLib.jl</title><meta name="title" content="Readers · BGZFLib.jl"/><meta property="og:title" content="Readers · BGZFLib.jl"/><meta property="twitter:title" content="Readers · BGZFLib.jl"/><meta name="description" content="Documentation for BGZFLib.jl."/><meta property="og:description" content="Documentation for BGZFLib.jl."/><meta property="twitter:description" content="Documentation for BGZFLib.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BGZFLib.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">BGZFLib</a></li><li class="is-active"><a class="tocitem" href>Readers</a><ul class="internal"><li><a class="tocitem" href="#Errors-and-error-recovery"><span>Errors and error recovery</span></a></li><li><a class="tocitem" href="#Reference"><span>Reference</span></a></li></ul></li><li><a class="tocitem" href="../writers/">Writers</a></li><li><a class="tocitem" href="../gzindex/">Seeking</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Readers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Readers</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="BGZF-readers"><a class="docs-heading-anchor" href="#BGZF-readers">BGZF readers</a><a id="BGZF-readers-1"></a><a class="docs-heading-anchor-permalink" href="#BGZF-readers" title="Permalink"></a></h1><h3 id="BGZFReader-and-SyncBGZFReader"><a class="docs-heading-anchor" href="#BGZFReader-and-SyncBGZFReader"><code>BGZFReader</code> and <code>SyncBGZFReader</code></a><a id="BGZFReader-and-SyncBGZFReader-1"></a><a class="docs-heading-anchor-permalink" href="#BGZFReader-and-SyncBGZFReader" title="Permalink"></a></h3><p>BGZFLib exposes two readers:</p><ul><li><code>BGZFReader</code> uses a number of worker tasks to decompress concurrently with reading. This gives the highest performance and should be the default choice. However, in my experience Julia&#39;s task scheduler is not fantastic and can cause performance problems.</li><li><code>SyncBGZFReader</code> avoids task scheduling by decompressing in the reading task. Therefore, it neither decompresses in parallel, nor concurrent with reading, which makes it slower. However, it is simpler, less likely to have bugs, and does not strain the scheduler.</li></ul><p>Most users should use <code>BGZFReader</code>.</p><h3 id="Constructing-BGZF-readers"><a class="docs-heading-anchor" href="#Constructing-BGZF-readers">Constructing BGZF readers</a><a id="Constructing-BGZF-readers-1"></a><a class="docs-heading-anchor-permalink" href="#Constructing-BGZF-readers" title="Permalink"></a></h3><p>Both readers make use of the <a href="file:///home/jakni/code/BufferIO.jl/docs/build/readers/index.html">AbstractBufReader interface</a>. They both contain un-expandable buffers, i.e. <code>fill_buffer</code> generally cannot expand the buffer size and will return <code>nothing</code> if the buffer is not empty.</p><p>Readers wrap another <code>AbstractBufReader</code> containing the compressed BGZF stream:</p><pre><code class="language-julia hljs">using BufferIO
using BGZFLib

reader = CursorReader(bgzf_data);
@assert reader isa AbstractBufReader
bgzf_reader = BGZFReader(reader)
println(String(read(bgzf_reader))) 
close(bgzf_reader)

# output
Hello, world!more dataxthen some moremore content herethis is another block</code></pre><p>The <code>AbstractBufReader</code> must be able to buffer a full BGZF block, or the remainder of the underlying file, whichever is smallest.</p><p>If an <code>AbstractBufReader</code> with less space is provided, a <code>BGZFError(nothing, BGZFErrors.insufficient_reader_space)</code> is thrown.</p><p>If a reader is constructed from an <code>IO</code>, it is automatically wrapped in a <code>BufReader</code> with an appropriate buffer size:</p><pre><code class="language-julia hljs">bgzf_reader = SyncBGZFReader(IOBuffer(bgzf_data))
println(String(read(bgzf_reader))) 
close(bgzf_reader)

# output
Hello, world!more dataxthen some moremore content herethis is another block</code></pre><p>Mutating the wrapped io object of a BGZF reader or writer is not permitted and can cause erratic behaviour.</p><h3 id="Reading-BGZF-files"><a class="docs-heading-anchor" href="#Reading-BGZF-files">Reading BGZF files</a><a id="Reading-BGZF-files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-BGZF-files" title="Permalink"></a></h3><p>Readers have a <code>check_truncated</code> keyword that defaults to <code>true</code>. If set to <code>true</code>, the reader will error if the last block in the stream is not empty, marking EOF:</p><p>Example with <code>check_truncated = true</code> (default)</p><pre><code class="language-julia hljs">reader = CursorReader(bgzf_data[1:end-28])
String(read(BGZFReader(reader)))

# output
ERROR: BGZFError(0, BGZFLib.BGZFErrors.truncated_file)
[...]</code></pre><p>And set to <code>false</code></p><pre><code class="language-julia hljs">reader = CursorReader(bgzf_data[1:end-28])
String(read(BGZFReader(reader; check_truncated = false)))

# output
&quot;Hello, world!more dataxthen some moremore content herethis is another block&quot;</code></pre><p>Like <code>Base.open</code>, the BGZF readers also have a method that takes a function as a first argument, and makes sure to close the reader even if it errors:</p><pre><code class="language-julia hljs">SyncBGZFReader(io -&gt; String(read(io)), CursorReader(bgzf_data))

# output
&quot;Hello, world!more dataxthen some moremore content herethis is another block&quot;</code></pre><h2 id="Errors-and-error-recovery"><a class="docs-heading-anchor" href="#Errors-and-error-recovery">Errors and error recovery</a><a id="Errors-and-error-recovery-1"></a><a class="docs-heading-anchor-permalink" href="#Errors-and-error-recovery" title="Permalink"></a></h2><p>Types in this package generally throw <code>BGZFError</code>s:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BGZFLib.BGZFError-readers" href="#BGZFLib.BGZFError-readers"><code>BGZFLib.BGZFError</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BGZFError &lt;: Exception</code></pre><p>Exception type thrown by BGZF readers and writers, when encountering errors specific to the BGZF (or gzip, or DEFLATE) formats. Note that exceptions thrown by BGZF readers and writers are not guaranteed to be of this type, as they may also throw <code>BufferIO.IOError</code>s, or exceptions propagated by their underlying IO.</p><p>This error contains two public properties:</p><ul><li><code>block_offset::Union{Nothing, Int}</code> gives the zero-based offset in the compressed stream  of the block where the error occurred.  Some errors may not occur at a specific block, in which case this is <code>nothing</code>.</li><li><code>type::Union{BGZFErrorType, LibDeflateError}</code>. If the blocks are malformed gzip blocks, this  is a <code>LibDeflateError</code>. Else, if the error is specific to the BGZF format, it&#39;s a BGZFErrorType.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BGZFLib.BGZFErrors-readers" href="#BGZFLib.BGZFErrors-readers"><code>BGZFLib.BGZFErrors</code></a> — <span class="docstring-category">Module</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">module BGZFErrors</code></pre><p>This module is used as a namespace for the enum <code>BGZFErrorType</code>. The enum is non-exhaustive (more variants may be added in the future). The current values are:</p><ul><li><code>truncated_file</code>: The reader data stops abruptly. Either in the middle of a block, or there is no empty block at EOF</li><li><code>missing_bc_field</code>: A block has no <code>BC</code> field, or it&#39;s malformed</li><li><code>block_offset_out_of_bounds</code>: Seek with a <code>VirtualOffset</code> where the block offset is larger than the block size</li><li><code>insufficient_reader_space</code>: The BGZF reader wraps an <code>AbstractBufWriter</code> that is not EOF, and its buffer can&#39;t grow to encompass a whole BGZF block</li><li><code>insufficient_writer_space</code>: A BGZF writer wraps an <code>AbstractBufWriter</code> whose buffer cannot grow to encompass a full BGZF block</li><li><code>unsorted_index</code>: Attempted to load a malformed GZI file with unsorted coordinates</li><li><code>operation_on_error</code>: Attempted an operation on a BGZF reader or writer in an error state.</li></ul></div></section></article><p>However, some operations on BGZF readers and writers propagate to their underlying IO, which may throw different errors. For example, when calling <code>seek</code> on a BGZF reader wrapping a file (e.g. <code>SyncBGZFReader{BufReader{IOStream}}</code>), <code>seek</code> is also called on the underlying <code>IOStream</code>. This may throw another error.</p><p>When attempting to read a malformed BGZF file, the reader will throw a <code>BGZFError</code> and be in an error state. In this state, some operations like <code>BufferIO.fill_buffer</code> and <code>Base.seek</code> will throw a <code>BGZFError(nothing, BGZFErrors.operation_on_error)</code>.</p><p>To recover the BGZF reader, <code>seek</code> to a valid position:</p><pre><code class="language-julia hljs">bad_data = append!(copy(bgzf_data), &quot;some bad data&quot;)
reader = BGZFReader(CursorReader(bad_data))

# Trigger an error from reading bad gzip data
try
    read(reader)
catch error
    @assert error isa BGZFError
    @assert error.type isa LibDeflateError
end

# Trying to read from a reader in an error state will throw
# a BGZF error.
# Note that e.g. calling `read` would throw the same error
try
    fill_buffer(reader)
catch error
    @assert error isa BGZFError
    @assert error.type === BGZFErrors.operation_on_error
end

# Reset the reader by calling `seek`. If seek succeeds, the error
# state will disappear.
seekstart(reader)
println(String(read(reader, 13)))
close(reader)

# output
Hello, world!
</code></pre><h2 id="Reference"><a class="docs-heading-anchor" href="#Reference">Reference</a><a id="Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Reference" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BGZFLib.BGZFReader-readers" href="#BGZFLib.BGZFReader-readers"><code>BGZFLib.BGZFReader</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BGZFReader(io::T &lt;: IO; n_workers::Int, check_truncated::Bool=true)::BGZFReader{BufReader{T}}
BGZFReader(io::T &lt;: AbstractBufReader; n_workers::Int, check_truncated::Bool=true)::BGZFReader{T}</code></pre><p>Create a <code>BGZFReader &lt;: AbstractBufReader</code> that decompresses a BGZF stream.</p><p>When constructing from an <code>io::AbstractBufReader</code>, <code>io</code> must have a buffer size of at least 65536, or be able to grow its buffer to this size.</p><p>If <code>check_truncated</code>, the last BGZF block in the file must be empty, otherwise the reader throws an error. This can be used to detect the file was truncated.</p><p>The decompression happens asyncronously in a set of worker tasks. To avoid spawning workers, use the <code>SyncBGZFReader</code> instead.</p><p>If the reader encounters an error, it goes into an error state and throws an exception. The reader can be reset by using <code>seek</code> or <code>seekstart</code>. A closed reader cannot be reset.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BGZFLib.SyncBGZFReader-readers" href="#BGZFLib.SyncBGZFReader-readers"><code>BGZFLib.SyncBGZFReader</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SyncBGZFReader(io::T &lt;: IO; check_truncated::Bool=true)::SyncBGZFReader{BufReader{T}}
SyncBGZFReader(io::T &lt;: AbstractBufReader; check_truncated::Bool=true)::SyncBGZFReader{T}</code></pre><p>Create a <code>SyncBGZFReader &lt;: AbstractBufReader</code> that decompresses BGZF files.</p><p>When constructing from an <code>io::AbstractBufReader</code>, <code>io</code> must have a buffer size of at least 65536, or be able to grow its buffer to this size.</p><p>If <code>check_truncated</code>, the last BGZF block in the file must be empty, otherwise the reader throws an error. This can be used to detect the file was truncated.</p><p>Unlike <code>BGZFReader</code>, the decompression happens in in serial in the main task. This is slower and does not enable paralellism, but may be preferable in situations where task scheduling or contention is an issue.</p><p>If the reader encounters an error, it goes into an error state and throws an exception. The reader can be reset by using <code>seek</code> or <code>seekstart</code>. A closed reader cannot be reset.</p></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« BGZFLib</a><a class="docs-footer-nextpage" href="../writers/">Writers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 13 October 2025 12:42">Monday 13 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
